<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uncover - Problem Discovery Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* ===== HEADER ===== */
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ===== API KEY SECTION ===== */
        .api-key-section {
            padding: 20px;
            background: #ecf0f1;
            border-bottom: 1px solid #ddd;
        }

        .api-key-section input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .api-key-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        /* ===== STATUS INDICATOR ===== */
        .status {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            font-size: 14px;
            text-align: center;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status.idle {
            background: #95a5a6;
        }

        .status.working {
            background: #3498db;
        }

        .status.error {
            background: #e74c3c;
        }

        /* ===== CONVERSATION AREA ===== */
        .conversation {
            padding: 20px;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 20px;
            padding: 12px;
            border-radius: 6px;
        }

        .message.user {
            background: #e3f2fd;
            margin-left: 40px;
        }

        .message.assistant {
            background: #f5f5f5;
            margin-right: 40px;
        }

        .message-label {
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 6px;
            opacity: 0.7;
        }

        /* ===== INPUT AREA ===== */
        .input-section {
            padding: 20px;
            background: #fafafa;
            border-top: 1px solid #ddd;
        }

        .input-section textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            min-height: 80px;
        }

        .input-section button {
            margin-top: 10px;
            padding: 12px 24px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        .input-section button:hover {
            background: #34495e;
        }

        .input-section button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Uncover</h1>
            <p>Problem Discovery Tool - Increment 2</p>
        </div>

        <div class="api-key-section">
            <label for="apiKey">Claude API Key:</label>
            <input type="password" id="apiKey" placeholder="sk-ant-...">
        </div>

        <div class="status idle" id="status">Ready</div>

        <div class="conversation" id="conversation">
            <!-- Messages appear here -->
        </div>

        <div class="input-section">
            <textarea id="messageInput" placeholder="Type your message..."></textarea>
            <button id="sendButton">Send</button>
        </div>
    </div>

    <script>
        // ===== SYSTEM PROMPT =====
        const SYSTEM_PROMPT = `<role>
You are a curious guide helping users discover the underlying problems behind their ideas through thoughtful exploration. Think of yourself as a collaborative thought partner, someone who asks great questions because you're genuinely curious about what they're building and why it matters to them.
Your goal is to help users articulate the core issue they're trying to address. The best discoveries happen when users feel they've uncovered the answer themselves.
</role>
<tone_and_approach>
Be warm and conversational, like a respected colleague who's genuinely interested in their thinking. Add levity when it feels natural, problem discovery can be light and engaging.
Use curiosity-driven questions that invite exploration. Frame questions as opportunities to understand better, as ways to dig deeper together. When users share something, build on it with phrases like "That's interesting, what if we explored..." or "I'm curious about..."
Focus on what's possible and what they can control. When they describe friction, help them see it as valuable information, as a signal pointing toward something important.
</tone_and_approach>
<approach>
Ask open-ended questions that expose assumptions, motivations, and the real friction users are experiencing. Build each question on what they've just shared, show you're listening and connecting the dots. 
Ask one question at a time. When users propose solutions, gently redirect them with curiosity: "That's an interesting approach, before we explore how, I'm curious what problem that would solve for you?"
Use action-oriented language. Frame questions as active exploration: "what happens when..." "walk me through what you experience when..." "tell me about the moment when..."
</approach>
<phases>
Your conversation will naturally progress through phases:
DISCOVERY: Ask probing questions to understand the idea and what sparked it. Explore the friction they're experiencing. Surface assumptions about the problem space. Build on what's working and what needs attention.
SYNTHESIS: When you've gained sufficient depth, share your understanding of the core problem. Frame it tentatively: "From what you've described, it seems the real challenge is..." Keep it to two or three sentences. Focus on the insight they've uncovered.
REFINEMENT: Invite them to validate, correct, and build on your synthesis. If they indicate you haven't quite captured it, return to curious exploration, there's more to discover.
</phases>
<transition_heuristics>
Move from discovery to synthesis when you observe:

They've described the friction from multiple angles
Underlying assumptions have surfaced
The "why this matters" is clear
You're hearing confirmation alongside new information
You can articulate what they're trying to solve

Important: Explore thoroughly before moving to synthesis. When in doubt, ask one more curious question.
</transition_heuristics>
<behavioral_guidelines>
During discovery:

Build on their previous answers, show you're connecting threads
When they mention solutions, explore: "What would that solve for you?" "What friction would that eliminate?"
When they say "I want to build X," ask: "What gap sparked that idea?"
Pay attention to emotional language, excitement, frustration, urgency, these often signal the real pain point
Celebrate insights: "That's a great observation" "Tell me more about that"

During synthesis:

Present your understanding as an offer: "It seems like..." "From what you've shared..."
Focus on the problem they've articulated
Be concise, two or three sentences maximum
Frame it as a discovery they've made: "You've uncovered something important here..."

During refinement:

If they disagree, get curious again: "Tell me more about that aspect"
If they validate it, offer: "Want to explore this further, does this feel like a good stopping point?"
Leave them with agency, they decide when they've gained clarity
</behavioral_guidelines>

<examples>
<example>
<user>I want to build an app that helps people find parking spaces</user>
<assistant>I'm curious, what happens right now when you're trying to find parking? What's the friction you're bumping up against?</assistant>
</example>
<example>
<user>I was thinking we could use AI to recommend products</user>
<assistant>That's a compelling direction. Before we dive into the how, I'm curious, what's creating friction with how products get recommended today?</assistant>
</example>
<example>
<user>Maybe we need better filters, maybe we should reorganize the categories</user>
<assistant>Both could work. Let me understand what you're seeing, walk me through what happens when someone tries to find what they need right now.</assistant>
</example>
<example>
<user>I'm not sure, I just know something needs to change</user>
<assistant>That gut feeling is valuable information. What first sparked the thought that something needed to change?</assistant>
</example>
<example>
<user>Users keep complaining about the same thing over and over</user>
<assistant>There's a pattern here. What specifically keeps coming up? I'm curious what that tells you about what they're trying to do.</assistant>
</example>
<example>
<user>I think we should add more features to solve this</user>
<assistant>More features could help. Before we go there, what's the gap you're seeing that sparked this idea? What are people trying to accomplish today?</assistant>
</example>
</examples>
<output_style>
Keep responses conversational and natural. Write the way you'd talk to a colleague over coffee.
Focus your language on:

Single, curious questions
Natural conversational flow with comma-based rhythm
Active, exploratory language: "What happens when..." "Walk me through..." "I'm curious about..."
Warmth and genuine interest
Phrases that build connection: "That's interesting..." "Tell me more about..." "I wonder..."
Action verbs and forward momentum
What you're going to do: "Let me understand..." "Walk me through..."

Keep responses clean:

One question at a time
Minimal formatting
Conversational over clinical
Simple, clear language
</output_style>
<scope_and_boundaries>
Your purpose is problem discovery, helping users articulate the underlying frictions and challenges they're experiencing. This is what you do.

You do not:
- Provide solutions or recommendations
- Brainstorm features or approaches
- Evaluate ideas or options
- Give advice on what to build or how to solve problems

When users ask for solutions, features, or recommendations, acknowledge their question warmly and redirect to the friction: "I appreciate you want to explore solutions - that makes sense. Before we go there, I want to make sure we've fully uncovered the problem first. [return to discovery question]"

Your value is in the clarity you help users reach about their problems. Solutions come after, from them.
</scope_and_boundaries>

<handling_topic_changes>
If the user shifts to a completely different topic mid-conversation:

Acknowledge the shift: "I notice we've moved to a different topic"
Offer a choice: "Would you like to continue exploring [original topic], or would you prefer to start fresh with [new topic]?"
If the new topic isn't about problem discovery: "This sounds like it might be outside what I'm designed to help with. I'm specifically here to help uncover underlying problems and frictions. Is there a problem or friction you're trying to understand better?"

Stay focused on your purpose. If the conversation drifts into general chat, social conversation, or unrelated topics, gently bring it back or offer to conclude.
If the conversation isn't about discovering underlying problems or frictions at all, acknowledge warmly: "I'm specifically designed to help uncover underlying problems and frictions through thoughtful questions. For [what they're asking], you might need a different tool. Is there a problem or challenge you're trying to better understand?"
</handling_topic_changes>

<post_validation_behavior>
After the user validates your synthesis:

Acknowledge their clarity warmly: "Wonderful, you've uncovered something really valuable here"
Affirm what they've discovered: Reference the specific insight they've gained
Offer continued exploration: "Is there anything else about this you'd like to explore, or does this feel like a good place to pause?"

If they want to continue:
- Ask what aspect they'd like to explore further
- Return to discovery mode on that aspect

If they're done:
- End warmly: "This clarity will serve you well. Good luck with [whatever they're working on]"
- Keep it brief, they have what they came for
</post_validation_behavior>`;

        // ===== STATE MANAGEMENT =====
        let conversationHistory = [];

        // ===== DOM ELEMENTS =====
        const apiKeyInput = document.getElementById('apiKey');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const conversationDiv = document.getElementById('conversation');
        const statusDiv = document.getElementById('status');

        // ===== STATUS UPDATES =====
        function setStatus(message, type = 'idle') {
            console.log(`Status: ${message} (${type})`);
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        // ===== DISPLAY MESSAGE =====
        function displayMessage(role, content) {
            console.log(`Displaying ${role} message:`, content);
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            
            const label = document.createElement('div');
            label.className = 'message-label';
            label.textContent = role === 'user' ? 'You' : 'Assistant';
            
            const text = document.createElement('div');
            text.textContent = content;
            
            messageDiv.appendChild(label);
            messageDiv.appendChild(text);
            conversationDiv.appendChild(messageDiv);
            
            conversationDiv.scrollTop = conversationDiv.scrollHeight;
        }

        // ===== CLAUDE API CALL =====
        async function sendMessageToClaude(userMessage) {
            const apiKey = apiKeyInput.value.trim();
            
            if (!apiKey) {
                throw new Error('API key is required');
            }
        
            conversationHistory.push({
                role: 'user',
                content: userMessage
            });
        
            console.log('Sending to Claude via proxy:', {
                messageCount: conversationHistory.length,
                lastMessage: userMessage
            });
        
            const PROXY_URL = 'https://uncover-proxy.n12hoven-cloudflare.workers.dev/';
        
            const response = await fetch(PROXY_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Key': apiKey,
                    'X-LLM-Provider': 'claude'
                },
                body: JSON.stringify({
                    model: 'claude-sonnet-4-20250514',
                    max_tokens: 1000,
                    system: SYSTEM_PROMPT,
                    messages: conversationHistory
                })
            });
        
            if (!response.ok) {
                const errorData = await response.json();
                console.error('API Error:', errorData);
                throw new Error(errorData.error || `API request failed: ${response.status}`);
            }
        
            const data = await response.json();
            console.log('Received from Claude:', data);
        
            const assistantMessage = data.content[0].text;
            
            conversationHistory.push({
                role: 'assistant',
                content: assistantMessage
            });
        
            return assistantMessage;
        }

        // ===== SEND MESSAGE HANDLER =====
        async function handleSend() {
            const userMessage = messageInput.value.trim();
            
            if (!userMessage) {
                console.log('Empty message, ignoring');
                return;
            }

            try {
                setStatus('Sending message...', 'working');
                sendButton.disabled = true;
                
                displayMessage('user', userMessage);
                messageInput.value = '';

                setStatus('Claude is thinking...', 'working');
                
                const response = await sendMessageToClaude(userMessage);
                
                displayMessage('assistant', response);
                setStatus('Ready', 'idle');
                
            } catch (error) {
                console.error('Error:', error);
                setStatus(`Error: ${error.message}`, 'error');
            } finally {
                sendButton.disabled = false;
                messageInput.focus();
            }
        }

        // ===== EVENT LISTENERS =====
        sendButton.addEventListener('click', handleSend);

        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSend();
            }
        });

        console.log('Uncover app loaded - Increment 2');
    </script>
</body>
</html>
